<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space XMD Hosting</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>üöÄ Space XMD Hosting</h1>

<input type="text" id="username" placeholder="Enter your GitHub username">
<button onclick="checkFork()">Check Repo</button>

<div id="actions" style="margin-top:20px;"></div>
<div id="logs" style="white-space:pre-wrap; background:#000; color:#0f0; padding:10px; width:90%; max-width:600px; height:200px; overflow:auto; margin-top:20px;"></div>

<script>
const actions = document.getElementById("actions");
const logs = document.getElementById("logs");

function log(msg) {
    logs.textContent += msg + "\n";
    logs.scrollTop = logs.scrollHeight;
}

async function checkFork() {
    const username = document.getElementById("username").value.trim();
    if (!username) { alert("Enter username"); return; }
    log("üîç Checking if repo is forked...");

    const res = await fetch("/checkFork", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({username})
    });
    const data = await res.json();

    actions.innerHTML = "";

    if(data.forked) {
        log("‚úÖ Repo already forked!");
        const deployBtn = document.createElement("button");
        deployBtn.textContent = "Deploy to Render";
        deployBtn.onclick = () => {
            const renderURL = `https://render.com/deploy?repo=${data.repo}`;
            window.open(renderURL, "_blank");
            log("üöÄ Deployment started on Render...");
        };
        actions.appendChild(deployBtn);
    } else {
        log("‚ö†Ô∏è Repo not forked yet");
        const forkBtn = document.createElement("button");
        forkBtn.textContent = "Fork Space-XMD";
        forkBtn.onclick = async () => {
            log("‚è≥ Forking repo...");
            const forkRes = await fetch("/fork", {
                method:"POST",
                headers: {"Content-Type":"application/json"},
                body: JSON.stringify({username})
            });
            const forkData = await forkRes.json();
            if(forkData.success) {
                log("‚úÖ Repo forked successfully!");
                checkFork();
            } else {
                log("‚ùå Fork failed: " + forkData.error);
            }
        };
        actions.appendChild(forkBtn);
    }
}
</script>

</body>
</html>